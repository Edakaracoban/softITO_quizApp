@model List<QuizProject.Data.Models.TestType>
@{
    ViewData["Title"] = "Select a Test Type";
    Layout = "~/Views/Shared/_StudentLayout.cshtml";

    var testTypes = Model ?? new List<QuizProject.Data.Models.TestType>();
    var count = testTypes.Count;
    var angleStep = 360.0 / (count == 0 ? 1 : count);
    var radius = 600;
    var index = 0;
}
<style>
    body {
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
        font-family: 'Segoe UI', sans-serif;
    }

    .center-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 2;
    }

    h2 {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: #333;
    }

    #searchInput {
        padding: 0.75rem 1rem;
        border-radius: 10px;
        border: 1px solid #ccc;
        width: 350px;
        font-size: 1rem;
        margin-bottom: 1rem;
    }

        #searchInput:focus {
            border-color: #198754;
            outline: none;
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
        }

    .testtype-circle {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 600px;
        height: 500px;
        margin-left: -350px;
        margin-top: -350px;
        pointer-events: none;
        z-index: 1;
    }

    .testtype-card {
        position: absolute;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: #ffffff;
        border: 2px solid #198754;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        transition: transform 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        cursor: pointer;
        pointer-events: auto;
        user-select: none;
    }

        .testtype-card:hover {
            transform: scale(1.6);
            background-color: #198754;
            border-color: #198754;
            box-shadow: 0 15px 30px rgba(40, 167, 69, 0.7);
            color: white;
        }

            .testtype-card:hover .testtype-name {
                color: white;
            }

    .testtype-image {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ddd;
        margin-bottom: 0.4rem;
        transition: border-color 0.3s ease;
    }

    .testtype-card:hover .testtype-image {
        border-color: white;
    }

    .testtype-name {
        font-size: 1rem;
        font-weight: 600;
        color: #333;
        transition: color 0.3s ease;
        user-select: none;
    }
</style>

<div class="center-content">
    <h2>Select a Test Type for <strong>@ViewBag.CategoryName</strong></h2>
    <input type="text" id="searchInput" placeholder="Search test types..." />
</div>

<div class="testtype-circle" id="testTypeCircle">
    @foreach (var testType in testTypes)
    {
        var angleDeg = index * angleStep;
        var angleRad = angleDeg * Math.PI / 180;
        var x = radius * Math.Cos(angleRad);
        var y = radius * Math.Sin(angleRad);
        <div class="testtype-card"
             data-id="@testType.Id"
             data-name="@testType.Name"
             data-image="@(string.IsNullOrEmpty(testType.ImageUrl) ? "/img/default-testtype.png" : testType.ImageUrl)"
             style="top: calc(50% + @(y)px); left: calc(50% + @(x)px);">
            <img class="testtype-image" src="@(string.IsNullOrEmpty(testType.ImageUrl) ? "/img/default-testtype.png" : testType.ImageUrl)" alt="@testType.Name" />
            <div class="testtype-name">@testType.Name</div>
        </div>
        index++;
    }
</div>

<script>
    const searchInput = document.getElementById('searchInput');
    const testTypeCircle = document.getElementById('testTypeCircle');
    const categoryId = "@ViewBag.CategoryId"; // ✅ string olarak alındı

    let allTestTypes = Array.from(testTypeCircle.children).map(card => ({
        id: card.dataset.id,
        name: card.dataset.name,
        imageUrl: card.dataset.image
    }));

    function renderCircular(testTypes) {
        testTypeCircle.innerHTML = '';
        const radius = 300;
        const angleStep = 360 / (testTypes.length || 1);

        testTypes.forEach((tt, i) => {
            const angleDeg = i * angleStep;
            const angleRad = angleDeg * Math.PI / 180;
            const x = radius * Math.cos(angleRad);
            const y = radius * Math.sin(angleRad);

            const card = document.createElement('div');
            card.className = 'testtype-card';
            card.setAttribute('data-id', tt.id);
            card.style.top = `calc(50% + ${y}px)`;
            card.style.left = `calc(50% + ${x}px)`;
            card.innerHTML = `
                <img class="testtype-image" src="${tt.imageUrl}" alt="${tt.name}" />
                <div class="testtype-name">${tt.name}</div>
            `;

            card.addEventListener('click', () => {
                window.location.href = `/Student/Dashboard/Index?testTypeId=${tt.id}&categoryId=${categoryId}`;
            });

            testTypeCircle.appendChild(card);
        });
    }

    renderCircular(allTestTypes);

    searchInput.addEventListener('input', () => {
        const term = searchInput.value.toLowerCase();
        const filtered = allTestTypes.filter(tt => tt.name.toLowerCase().includes(term));
        renderCircular(filtered);
    });
</script>

