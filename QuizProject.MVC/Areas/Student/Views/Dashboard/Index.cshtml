@{
    ViewData["Title"] = "Start Quiz";
    Layout = "~/Views/Shared/_StudentLayout.cshtml";
}

@section Styles {
    <style>
        html.splash-active body {
            overflow: hidden;
        }
        #splash {
            position: fixed;
            inset: 0;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease;
            flex-direction: column;
            z-index: 999;
            text-align: center;
        }

        /* 🔹 GIF sadece arka planda dursun */
        .splash-gif {
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 1000px; /* ✅ Özel genişlik */
            height: auto; /* 🔁 Oran bozulmadan yükseklik ayarlanır */
            object-fit: cover;

            z-index: -1;
        }
        #splash.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        #splash-content {
            z-index: 10000;
            position: relative;
            background-color: rgba(255, 255, 255, 0.85);
            padding: 30px;
            border-radius: 15px;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            animation: fadeInUp 2s ease forwards;
            text-align: center;

        }

        .testtype-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #198754;
            margin: 10px auto;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            display: block;
        }

        #startQuizBtn {
            margin-top: 20px;
            font-size: 1.1rem;
            padding: 10px 20px;
            background-color: #198754;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

            #startQuizBtn:hover {
                background-color: #146c43;
            }

        @@keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
}

@section Scripts {
    <script>
        document.documentElement.classList.add('splash-active');

        let timerInterval;
        let countdown = 180;

        const timerElement = document.getElementById("timer");
        const splash = document.getElementById("splash");
        const startBtn = document.getElementById("startQuizBtn");
        const splashImage = splash.querySelector('.splash-gif');
        const clickSound = document.getElementById("clickSound");

        const startCountdown = () => {
            clickSound.loop = true;
            clickSound.currentTime = 0;
            clickSound.play();

            timerInterval = setInterval(() => {
                countdown--;
                timerElement.textContent = countdown;

                if (countdown <= 0) {
                    clearInterval(timerInterval);
                    clickSound.pause();
                    alert("Time is up. Redirecting to login...");
                    window.location.href = '/Account/Login?role=Student';
                }
            }, 1000);
        };

        startBtn.addEventListener("click", () => {
            clearInterval(timerInterval);

            splash.classList.add('fade-out');
            splashImage.classList.add('fade-out');

                 setTimeout(() => {
            clickSound.loop = false;
            clickSound.pause();
            const quizId = startBtn.getAttribute("data-quiz-id");
            window.location.href = `/Student/Dashboard/Start?quizId=${quizId}`;
        }, 3000);

        });

        document.addEventListener('DOMContentLoaded', () => {
            startCountdown();
        });
    </script>
}

<!-- ✅ Splash sadece gövde kısmında -->
<div id="splash">
    <img src="~/img/giphy.gif" alt="Splash" class="splash-gif" asp-append-version="true" />

    <div id="splash-content">
        <h4>🎓 Are you ready for <strong>@ViewBag.TestTypeName</strong> in <strong>@ViewBag.CategoryName</strong>?</h4>
        <img src="@ViewBag.TestTypeImage" alt="@ViewBag.TestTypeName" class="testtype-image" />
        <p>You have <span id="timer">180</span> seconds to start.</p>
        <button id="startQuizBtn" data-quiz-id="@ViewBag.QuizId">Start Quiz</button>
    </div>
</div>


<audio id="clickSound" src="/sounds/mixkit-tick-tock-clock-timer-1045.mp3" preload="auto"></audio>
